<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>{#wce.note_title}</title>
<script type="text/javascript" src="../../tiny_mce_popup.js"></script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="js/wce.js"></script>
</head>
<body id="table" style="display: none">
	<form onsubmit="return false;" action="#" name="noteinfo">
		<fieldset>
			<legend>{#wce.note_data}</legend>
			<table border="0" cellpadding="4" cellspacing="0" width="100%">
				<tr>
					<td><label id="note_type_label" for="note_type">{#wce.note_type}</label>
					</td>
					<td>
					<select id="note_type" name="note_type"
						onclick="checkstatus_notetype()">
							<option value="editorial">{#wce.editorial}</option>
							<option value="local">{#wce.local}</option>
							<option value="canonRef">{#wce.canon}</option>
							<option value="changeOfHand">{#wce.changeOfHand}</option>
							<option value="other">{#wce.other}</option>
					</select>
					</td>
					<td><input id="note_type_other" name="note_type_other"
						type="text" value="" size="30" maxlength=""
						class="required number min1 mceFocus" />
					</td>
				</tr>
				<tr>
					<td><label id="newHand_label" for="newHand">{#wce.newHand}</label>
					</td><td><input id="newHand" name="newHand"
						type="text" value="" size="30" maxlength=""
						class="required number min1 mceFocus" />
					</td>
				</tr>
				<tr>
					<td><label id="note" for="note">{#wce.note}</label>
					</td>
					<td colspan=2><textarea id="note_text" name="note_text"
							WRAP="PHYSICAL" ROWS="12" COLS="50"></textarea>
					</td>
				</tr>
			</table>
		</fieldset>
		<div class="mceActionPanel">
			<input type="button" id="insert" name="insert" value="{#insert}"
				onclick="cont = testOther();cont2 = testText();
						if (cont&&cont2){writeWceNodeInfo();} else{ if(!cont){ alert('{#wce.empty_other}');} else{ alert('{#wce.empty_text}');}}"/>
			<input type="button" id="cancel" name="cancel" value="{#cancel}"
				onclick="tinyMCEPopup.close();" />
		</div>
	</form>
</body>
<script type="text/javascript">
	tinyMCEPopup.onInit.add(function(_ed){
		ed=_ed;
		setConstants(); 
		init();
	});
		
	
	function init() {
		comboBindReturnEvent('insert'); 
		wceInfoInit('note');
		readWceNodeInfo();
		setstatus_note();
	}
	function checkstatus_notetype() {
		if (document.noteinfo.note_type.options[4].selected == true) {
			document.noteinfo.note_type_other.disabled = false;
			document.getElementById('note_type_other').style.backgroundColor = "white";
		} else {
			document.noteinfo.note_type_other.disabled = true;
			document.getElementById('note_type_other').style.backgroundColor = "#CCCCCC";
		}
		if (document.noteinfo.note_type.options[3].selected == true) {
			document.noteinfo.newHand.disabled = false;
			document.getElementById('newHand').style.backgroundColor = "white";
		} else {
			document.noteinfo.newHand.disabled = true;
			document.getElementById('newHand').style.backgroundColor = "#CCCCCC";
		}
	}
	
	function setstatus_note() {
		checkstatus_notetype();
	}

	function testOther() {
		if (document.noteinfo.note_type.options[3].selected == true && document.getElementById('newHand').value == '')
			return false;
		if (document.noteinfo.note_type.options[4].selected == true && document.getElementById('note_type_other').value == '') 
			return false;
	return true;
	}
	
	function testText() {
		return (document.noteinfo.note_text.value !== '')
	}
	

	if (!tinyMCE.isIE) {
		$(document).keydown(function(e) {
			var evt = e || window.event
			if ((evt.keyCode == 13 || evt.keyCode == 10) && !evt.shiftKey) {
				document.getElementById('insert').click();
				return false;
			}
		});
	}
</script>
</html>
