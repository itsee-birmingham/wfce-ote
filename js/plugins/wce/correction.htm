<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>{#wce.reading_title}</title>
<script type="text/javascript" src="../../tiny_mce_popup.js"></script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="js/wce.js"></script>
</head>

<body id="table" style="display: none" onload="init();">
	<form onsubmit="insertTable();return false;" action="#"
		name="readinginfo" style="margin: 0; padding: 0">
		<fieldset style="width: 200px; float: left; height: 350px">
			<legend>{#wce.reading_list}</legend>
			<div style="height: 320px; overflow: auto">
				<ul id="correction_ul"
					style="list-style-position: inside; list-style-type: none; margin: 0px; padding: 10px">
				</ul>
			</div>
			<div style="text-align: right">
				<input type="button" onclick="cont = testOther();if (cont){addCorrector(); selectCorrItem();}else{alert('{#wce.empty_other}');}"
					value="New" />
			</div>
		</fieldset>
		<input type="hidden" id="original_firsthand_reading" name="original_firsthand_reading" value="" />
		<fieldset id="content_fieldset"
			style="margin-left: 220px; height: 350px; width: 450px">
			<legend>{#wce.reading_data}</legend>
			<div style="height: 320px; overflow: auto">
				<table border="0" cellpadding="4" cellspacing="0" width="100%">
					<tr>
						<td><label id="reading_label" for="reading">{#wce.reading_type}</label>
						</td>
						<td colspan="2"><select id="reading" name="reading">
								<option value="corr">{#wce.correction}</option>
								<option value="comm">{#wce.commentary}</option>
								<option value="alt">{#wce.alternative}</option>
						</select></td>
					</tr>
					<tr>
						<td><label id="firsthand_label" for="firsthand_reading">First
								hand reading</label></td>
						<td colspan="1"><label id="firsthand_reading"
							style="color: green" /></td>
						<td><input type="checkbox" name="blank_firsthand"
							id="blank_firsthand" value="blank_firsthand"
							onclick="checkstatus_firsthand()">{#wce.blank_firsthand}

						
						</td>
					</tr>
					<tr>
						<td><label id="corrector_name_label" for="corrector_name">{#wce.corrector_name}</label>
						</td>
						<td><select id="corrector_name" name="corrector_name"
							onclick="saveCurrCorrector(true);" onchange="checkstatus_hand()">
								<option value="firsthand">{#wce.firsthand}</option>
								<option value="corrector1">{#wce.corrector}1</option>
								<option value="corrector2">{#wce.corrector}2</option>
								<option value="corrector3">{#wce.corrector}3</option>
								<option value="unidentified_corrector">{#wce.unidentified_corrector}</option>
								<option value="hand_other">{#wce.other}</option>
						</select></td>
						<td><input id="corrector_other" name="corrector_other"
							onkeyup="saveCurrCorrector(true);" type="text" value="" size="30" />
						</td>
					</tr>
					<tr>
						<td><label id="corrector_text_label" for="corrector_text">{#wce.corrector_text}</label>
						</td>
						<td colspan="2" rowspan="2"><textarea WRAP="PHYSICAL"
								ROWS="3" COLS="50" id="corrector_text" name="corrector_text"></textarea>
						</td>
					</tr>
					<tr>
						<td><input type="checkbox" name="blank_correction"
							id="blank_correction" value="blank_correction"
							onclick="checkstatus_correction()">{#wce.blank_correction}

						
						</td>
					</tr>
					<tr>
						<td><label id="place_corr_label" for="place_corr">{#wce.corrector_place}</label>
						</td>
						<td colspan="2"><select id="place_corr" name="place_corr">
								<option value=""></option>
								<option value="overwritten">{#wce.corr_overwritten}</option>
								<option value="above">{#wce.corr_above}</option>
								<option value="below">{#wce.corr_below}</option>
								<option value="left margin">{#wce.corr_lmargin}</option>
								<option value="right margin">{#wce.corr_rmargin}</option>
								<option value="top">{#wce.corr_top}</option>
								<option value="bottom">{#wce.corr_bottom}</option>
								<option value="elsewhere">{#wce.corr_elsewhere}</option>
						</select></td>
					</tr>
					<tr>
						<td><label id="deletion_label" for="deletion">{#wce.deletion}</label>
						</td>
						<td colspan="2"><select id="deletion" name="deletion">
								<option value=""></option>
								<option value="erased">{#wce.del_erased}</option>
								<option value="underline">{#wce.del_underline}</option>
								<option value="underdot">{#wce.del_underdot}</option>
								<option value="strikethrough">{#wce.del_striketrough}</option>
								<option value="vertical line">{#wce.del_vertical_line}</option>
								<option value="Other">{#wce.other}</option>
						</select></td>
					</tr>
					<tr>
						<td><label id="editorial_note_label" for="editorial_note">{#wce.editorial_note}</label>
						</td>
						<td colspan="2"><textarea WRAP="PHYSICAL" ROWS="3" COLS="50"
								id="editorial_note" name="editorial_note"></textarea>
						</td>
					</tr>
				</table>
			</div>
			<div style="height: 20px;">
				<input type="reset" id="corr_reset" style="display: none"
					value="Reset" /> <input type="button"
					onclick="$('#corr_reset').click();saveCurrCorrector();"
					value="Reset" />
			</div>

		</fieldset>
		<div class="mceActionPanel">
			<input type="button" id="insert" name="insert" value="{#insert}"
				onclick="cont = testOther();if (cont){saveCurrCorrector(); writeWceNodeInfo();}else{alert('{#wce.empty_other}');}" /> <input
				type="button" id="cancel" name="cancel" value="{#cancel}"
				onclick="tinyMCEPopup.close();" />
		</div>
	</form>
</body>
<script type="text/javascript">
	function init() { 
		wceInfoInit('corr'); 
 
		$('#firsthand_reading').html(wce_node_text);
		$('#original_firsthand_reading').val(wce_node_text); 
		for ( var p in info_arr) {
			addCorrector(p);
		}

		selectCorrItem();

		if ($('#correction_ul > li').length < 1) {
			$('#content_fieldset').attr('disabled', true);
		}

		$(':input').change(function() {
			saveCurrCorrector();
		});

		checkstatus_hand();
		checkstatus_correction();
	}
	
	function testOther() {
		if (document.readinginfo.corrector_name.options[5].selected == true && document.getElementById('corrector_other').value == '') 
			return false;
	return true;
	}
	
	function checkstatus_hand() {
		if ($('#corrector_name').val() == 'hand_other') {
			$('#corrector_other').attr('disabled', false);
			$('#corrector_other').css('background', '#fff');
		} else {
			$('#corrector_other').attr('disabled', true);
			$('#corrector_other').css('background', '#ccc');
		}
	}

	function checkstatus_firsthand() {
		if (document.readinginfo.blank_firsthand.checked == true) {
			$('#firsthand_reading').css('color', 'lightgray');
		} else {
			$('#firsthand_reading').css('color', 'green');
		}
	}

	function checkstatus_correction() {
		if (document.readinginfo.blank_correction.checked == true) {
			$('#corrector_text').attr('disabled', true);
			$('#place_corr').attr('disabled', true);
		} else {
			$('#corrector_text').attr('disabled', false);
			$('#place_corr').attr('disabled', false);
		}
	}

	/*
	 * //add new <li> to <ul> /@param class_item: one item from class_name_arr
	 */
	function addCorrector(_id, corrector_name) {
		// default name of new corrector
		if (corrector_name == null) {
			corrector_name = 'new corrector';
		}

		$('#corr_reset').click();

		// new corrector
		if (_id == null) {
			item_counter++;
			_id = 'c' + item_counter;
			$('#corrector_text').val(wce_node_text);
			info_arr[_id] = formSerialize(null, corrector_name);
		} else {
			if (typeof info_arr[_id] != 'undefined' && info_arr[_id] != '') {
				var param_arr = info_arr[_id].split('&');
				corrector_name = param_arr[1];
				if (typeof corrector_name != 'undefined') {
					corrector_name = corrector_name.replace(name_in_uri + '=', '');
				}
			}
		}

		$('#correction_ul').append(
				'<li id="' + _id + '" ><img title="Delete" onclick="delCorrector(\'' + _id + '\');" src="img/del.gif" style="cursor:pointer; width:10px; height:10px; margin-right:10px" border="1"  /> <a href="javascript:void(0)" style="text-decoration:none" title="' + _id
						+ '" onclick="selectCorrItem(\'' + _id + '\');">' + corrector_name + '</a></li>');

		$('#content_fieldset').attr('disabled', false);

		checkstatus_firsthand();
		checkstatus_correction();
	}

	function delCorrector(_id) {
		$('#' + _id).remove();

		var li_length = $('#correction_ul > li').length;

		if (li_length < 1) {
			$('#content_fieldset').attr('disabled', true);
			curr_item_id = null;
		} else {
			var last_id = $('#correction_ul > li:eq(' + (li_length - 1) + ')').attr('id');
			if (last_id != null) {
				selectCorrItem(last_id);
			} else {
				curr_item_id = null;
			}
		}
		info_arr[_id] = null;
	}

	function saveCurrCorrector(b) {
		if (curr_item_id == null)
			return;

		var corrector_name;
		if (b) {
			corrector_name = $('#corrector_name').val();
			if (corrector_name == 'hand_other') {
				corrector_name = $('#corrector_other').val();
				if (corrector_name == '') {
					corrector_name = 'Other';
				}
			}
		} else {
			corrector_name = $('#' + curr_item_id + ' a').eq(0).html();
		}

		info_arr[curr_item_id] = formSerialize(null, corrector_name);
		$('#' + curr_item_id + ' a').html(corrector_name);

	}

	function selectCorrItem(_id) {
		$('#corr_reset').click();

		if (_id == null) {
			_id = 'c' + item_counter;
		}
		curr_item_id = _id;
		$('#correction_ul > li > a').css({
			'color' : '#000',
			'text-decoration' : 'none'
		});
		$('#' + _id + '   a').css({
			'color' : 'blue',
			'text-decoration' : 'underline'
		});
		var str = info_arr[_id];
		if (str == null) {
			$('#corr_reset').click();
		} else {
			formUnserialize(str);
		}
		checkstatus_hand();
		checkstatus_correction();
	}
</script>

</html>
