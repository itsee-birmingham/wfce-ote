<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>{#wce.break_title}</title>
<script type="text/javascript" src="../../tiny_mce_popup.js"></script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="js/wce.js"></script>
</head>

<body id="table" style="display: none" onload="init();">
	<form onsubmit="return false;" action="#" name="breakinfo">
		<fieldset>
			<legend>{#wce.break_data}</legend>
			<table border="0" cellpadding="4" cellspacing="0" width="100%">
				<tr>
					<td><label id="break_type_label" for="break_type">{#wce.break_type}</label>
					</td>
					<td colspan="2"><select id="break_type" name="break_type"
						onchange="checkstatus_break()">
							<option value="lb">{#wce.linebreak}</option>
							<option value="cb">{#wce.columnbreak}</option>
							<option value="pb">{#wce.pagebreak}</option>
							<option value="gb">{#wce.quire}</option>
					</select></td>
				</tr>
				<tr>
					<td><label id="number_label" for="number">{#wce.number}</label>
					</td>
					<td><input id="number" name="number" type="text" value=""
						size="10" maxlength="" class="required number min1 mceFocus" />
					</td>
					<td><label id="pb_type_label" for="pb_type">{#wce.pb_position}</label>
					</td>
					<td><select id="pb_type" name="pb_type">
							<option value=""></option>
							<option value="r">{#wce.recto}</option>
							<option value="v">{#wce.verso}</option>
					</select>
					</td>
					<td width=10></td>
					<td><label id="fibre_type_label" for="fibre_type">{#wce.fibre_type}</label>
					</td>
					<td><select id="fibre_type" name="fibre_type">
							<option value=""></option>
							<option value="x">{#wce.papyrus_fibre_h}</option>
							<option value="y">{#wce.papyrus_fibre_v}</option>
					
				</tr>
				<tr>
					<td><label id="running_title_label" for="running_title">{#wce.running_title}</label>
					</td>
					<td colspan="6"><input id="running_title" name="running_title" type="text" value=""
						size="50" maxlength="" class="required number min1 mceFocus" />
					</td>
				</tr>
				<tr>
					<td><label id="lb_alignment_label" for="lb_alignment">{#wce.alignment}</label>
					</td>
					<td colspan="2"><select id="lb_alignment" name="lb_alignment">
							<option value=""></option>
							<option value="leftJust">{#wce.alignment_lj}</option>
							<option value="centreJust">{#wce.alignment_cj}</option>
							<option value="rightJust">{#wce.alignment_rj}</option>
							<option value="indent">{#wce.alignment_indent}</option>
							<option value="hang">{#wce.alignment_hanging}</option>
					</select></td>
				</tr>
			</table>
		</fieldset>
		<div class="mceActionPanel">
			<input type="button" id="insert" name="insert" value="{#insert}"
				onclick="cont = testNumber();
						if (cont){writeWceNodeInfo(lbposition());}else{alert('{#wce.empty_number}');}" /> <input type="button"
				id="cancel" name="cancel" value="{#cancel}"
				onclick="tinyMCEPopup.close();" />
		</div>
	</form>
</body>
<script type="text/javascript">
	function init() {
		wceInfoInit('brea');
		readWceNodeInfo();
		setstatus_break();
	}

	function checkstatus_break() {
		if (document.breakinfo.break_type.options[0].selected == true) {
			document.breakinfo.lb_alignment.disabled = false;
		} else {
			document.breakinfo.lb_alignment.disabled = true;
		}
		if (document.breakinfo.break_type.options[2].selected == true) {
			document.breakinfo.pb_type.disabled = false;
			document.getElementById('pb_type').style.backgroundColor = "white";
			document.breakinfo.fibre_type.disabled = false;
			document.getElementById('fibre_type').style.backgroundColor = "white";
			document.breakinfo.running_title.disabled = false;
			document.getElementById('running_title').style.backgroundColor = "white";
		} else {
			document.breakinfo.pb_type.disabled = true;
			document.getElementById('pb_type').style.backgroundColor = "#CCCCCC";
			document.breakinfo.fibre_type.disabled = true;
			document.getElementById('fibre_type').style.backgroundColor = "#CCCCCC";
			document.breakinfo.running_title.disabled = true;
			document.getElementById('running_title').style.backgroundColor = "#CCCCCC";
		}
	}

	function setstatus_break() {
		checkstatus_break();
	}
	
	function testNumber() {
		if (document.getElementById('number').value == '') 
			return false;
	return true;
	}
	
	function _getNextEnd(endText, startOffset) {
		if (typeof endText == 'undefined')
			return startOffset;

		endText = endText.replace(/\xa0/gi, ' ');
		startOffset = endText.indexOf(' ', startOffset);
		if (startOffset < 0) {
			startOffset = endText.length;
		}
		return startOffset;
	}
	
	function lbposition() {
		var rng = ed.selection.getRng(true);
		var startNode = rng.startContainer;
		var startText = startNode.data ? startNode.data : startNode.innerText;
		if (rng.startOffset == _getNextEnd(startText,rng.startOffset))
			return 'lb';
		return 'lbm';
	}
</script>
</html>
